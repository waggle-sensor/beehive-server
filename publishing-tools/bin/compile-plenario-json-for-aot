#!/bin/sh

set -e

init_dir=$(pwd)

build_dir=$(mktemp -d -q)
echo "building in $build_dir"

cleanup() {
  echo "cleaning up $build_dir"
  rm -rf $build_dir
}

trap cleanup EXIT
cd $build_dir

mkdir -p digests
wget -P downloads 'http://www.mcs.anl.gov/research/projects/waggle/downloads/datasets/AoT_Chicago.public.recent.tar'
tar -C digests -xvf downloads/*.tar

# only expecting one project for now, but can be expanded to aggregate more
for dir in $(echo digests/*); do
  $init_dir/compile-plenario-json $dir > /tmp/plenario.json
  break
done
